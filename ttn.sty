%     ttn.sty: A LaTeX style for Turing Technical Notes.
%     Copyright (c) 2026 The Alan Turing Institute

%     This program is free software: you can redistribute it and/or modify
%     it under the terms of the GNU General Public License as published by
%     the Free Software Foundation, either version 3 of the License, or
%     (at your option) any later version.

%     This program is distributed in the hope that it will be useful,
%     but WITHOUT ANY WARRANTY; without even the implied warranty of
%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%     GNU General Public License for more details.

%     You should have received a copy of the GNU General Public License
%     along with this program.  If not, see <https://www.gnu.org/licenses/>.

%     James Geddes (jgeddes@turing.ac.uk)

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{ttn}[2026-01-20 Turing Technical Note]
%%
%% Turing Technical Notes
%% ----------------------
%
%% USAGE NOTES
%  -----------
% - Uses fontspec, so you will need to use lualatex or xelatex.
% 
%% TODO
%% ----
%  - Add an option to the package to choose the layout

%% Notes
%% -----
%
% The Turing's formatting guidelines divide the page into 21 equal
% columns (which turn out to be almost exactly 1cm wide). These
% columns are grouped to produce variations on the
% layout. Confusingly, the groups are also called columns; here they
% column-gruops are called Columns (with an uppercase C).
% 
% The guidelines define 4-Column, 5-Column, and 10-Column layouts. For
% example, a "4-Column layout" has four groups of 4 columns, plus a
% single-column gutter between each group, plus single-column margins;
% for a total of 21 columns.
%
% TODO: The ttn package provides two options: single-Column, centred
% text; and single-Column text with a wide right margin. The
% Guidelines do not provide a 1-Column layout so we need to adapt the
% "Turing Grid" to make sensible widths.
%
% Centred-text
%
% 3 cm margins and 15 cm text width. 
%
% Obtained by starting with the 10-Column layout and including the
% first and last Columns in the margin. That gives 3-cm margins, and a
% 15cm text width (equivalent to 7 groups of 1 column plus 1 gutter,
% plus another group).
%
% Wide right-hand margin
%
% 1 cm left and right gutter margins; 11 cm text width; 1cm between
% the text and right-hand margin; 7 cm right margin (and the the 1 cm
% gutter to the edge of the page).
%
% Based on the 5-Column layout: The text takes up the first three
% Columns (less the final gutter) and the right margin takes up the
% last two Columns. 
%
\RequirePackage[a4paper]{geometry}
%%
\newlength{\turingcolwd} % 1/21 of the paper width
\newlength{\turingcolht} % 1/21 of the paper height
\setlength{\turingcolwd}{0.04762\paperwidth}
\setlength{\turingcolht}{0.04762\paperheight}
%%
\geometry{top=2\turingcolht, bottom=2\turingcolht}
\geometry{left=1\turingcolwd, textwidth=11\turingcolwd}
\geometry{marginparsep=1\turingcolwd, marginparwidth=7\turingcolwd}
%%
%% Fonts and typography
%%
%% The "Concrete Roman" and "AMS Euler" fonts were used by Donald Knuth for his
%% book "Concrete Mathematics". AMS Euler was created by Hermann Zapf.  
\RequirePackage{fontspec}
\RequirePackage{microtype}
\setmainfont[Numbers=OldStyle]{CMU Concrete}
\setsansfont{CMU Bright}
\RequirePackage[math-style=upright]{unicode-math}
% \usepackage[math-style=upright]{unicode-math}
\setmathfont{Euler Math}
\setmathfont{Asana Math}[range={"2A74}] % fallback for "::="
\RequirePackage[sf,bf]{titlesec}
